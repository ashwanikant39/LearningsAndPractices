@model BEEKP.Models.BankFinancialViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*-------------Datatable CSS------------------*@
<link href="~/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css" rel="stylesheet" />

@*-------------Datatable JS------------------*@

<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/assets/global/plugins/datatables/media/js/jquery.dataTables.js"></script>
<script src="~/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>


@using (Html.BeginForm("Index", "BankFinancial", FormMethod.Post, new { @id = "frmBankFinancial", @name = "frmBankFinancial" }))
{
    @Html.AntiForgeryToken()

    <!-- BEGIN PAGE CONTENT -->
    <div class="container pt-10 pb-20">
        <!-- BEGIN PAGE CONTENT INNER -->
        <div class="row">

            @*<div class="col-md-6">
                    <div class="col-md-6">
                        <div class="portlet-title">
                            <div class="caption">
                                <span class="caption-subject font-green-sharp bold uppercase">Type Of Instituion</span>
                            </div>
                        </div>

                        <div class="col-md-6" id="vcluster">


                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="col-md-6">
                        <div class="portlet-title">
                            <div class="caption">
                                <span class="caption-subject font-green-sharp bold uppercase"></span>
                            </div>
                        </div>

                        <div class="col-md-6" id="vsector">

                        </div>
                    </div>
                </div>*@



            <div class="col-md-12">
                <section class="breadcrumb-area">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="inner-content clearfix">
                                    <div class="title_breadcrumb float-left">
                                        <h1>Banks and Financial Institutions</h1>
                                    </div>
                                    <div class="breadcrumb-menu float-right">
                                        <ul class="clearfix">
                                            <li><a href="/">Resources</a></li>
                                            <li class="active">Banks and Financial Institutions</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                @*<h4 class="text-theme-colored">Banks and Financial Institutions</h4>*@
                <hr />
                <div class="row">
                    <div class="col-md-12 mb-15">
                        <div class="bg_grey pt-7 clearfix">
                            <div class="col-sm-3 dis_grid" id="vcluster">
                                <div class="form-group">
                                    <label>Type of Instituion</label>
                                    @Html.DropDownList("TypeOfInstitution", new SelectList(Model.ListTypeOfInstitution, "institution_type_id", "institution_type_name", ""), new { @class = "form-control small-height-field", @id = "ddlTypeOfInstitution", @tabindex = "1", @onchange = "javascript:LoadBankFinancialList()" })
                                </div>
                            </div>
                            <div class="col-sm-3 dis_grid" id="vsector">
                                <div class="form-group">
                                    <label>Cluster</label>
                                    @Html.DropDownList("Cluster", new SelectList(Model.ListCluster, "cluster_id", "cluster_name", "--Select--"), new { @class = "form-control small-height-field", @id = "ddlcluster", @onchange = "javascript:LoadBankFinancialList()" })
                                </div>
                            </div>
                            <div class="col-sm-6 ">
                                <div class="form-group">
                                    <label>&nbsp;</label><br />
                                    <button type="button" onclick="LoadEnergyProfessional()" class="btn1 btn-primary">Search</button>
                                    <button type="button" onclick="" class="btn1 btn-default">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>


        <div class="row">
            <div class="col-md-12">

                <div class="portlet light">
                    @*<div class="portlet-title">
                            <div class="caption">
                                <span class="caption-subject font-green-sharp bold uppercase">BankFinancial List</span>
                            </div>
                        </div>*@
                    <div id="divBankFinancial" class="datatable-field-height">
                        @Html.Partial("_BankFinancialPartial", Model)
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT INNER -->

    </div>

}
<script>
    $(document).ready(function () {

        TableAdvanced_BankFinancial()

    });


    AddAntiForgeryToken = function (data) {
        data.__RequestVerificationToken = $('#frmBankFinancial input[name=__RequestVerificationToken]').val();
        return data;
    };





    function TableAdvanced_BankFinancial() {

        if (!jQuery().dataTable) {
            return;
        }

        var table = $('#tblBankFinancial');

        var oTable = table.dataTable({

            "language": {
                "aria": {
                    "sortAscending": ": activate to sort column ascending",
                    "sortDescending": ": activate to sort column descending"
                },
                "emptyTable": "No data available in table",
                "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                "infoEmpty": "No entries found",
                "infoFiltered": "(filtered1 from _MAX_ total entries)",
                "lengthMenu": "Show _MENU_ entries",
                "search": "Search:",
                "zeroRecords": "No matching records found"
            },

            "columnDefs": [{
                "orderable": false, // false = sorting not applicale
                "targets": [4] //for the columns
            }],
            //"order": [
            //    [0, 'asc'] // default column sorting
            //],
            "lengthMenu": [
                [10, 25, 50, 100, -1], // value - change per page values here
                [10, 25, 50, 100, "All"] // display- change per page values here
            ],
            // set the initial value
            "pageLength": 10
        });


    }

    function LoadBankFinancialList() {
        var institution_type_id = $("#ddlTypeOfInstitution").val();
        var cluster_id = $("#ddlcluster").val();


        $("#divBankFinancial").html("");


        $.ajax({

            url: '/BankFinancial/PopulateBankFinancialList',
            data: AddAntiForgeryToken({ sinstitution_type_id: institution_type_id, scluster_id: cluster_id }),
            async: false,
            type: 'POST',
            success: function (result) {

                if (result == 'sessionout') {
                    window.location.href = "/Account/LogOff";
                }
                else if (result.Data == 'error') {
                    window.location.href = "/Error/GeneralError";
                }
                else {
                    $("#divBankFinancial").html(result).show();
                    TableAdvanced_BankFinancial();
                    //Metronic.init();
                }
            },
            error: function (result) {
                isSuccess = result;
            }

        }).done(function () {
        });



    }

</script>